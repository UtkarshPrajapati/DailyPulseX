<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DailyPulseX - Breaking News</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-md-3">
                    <div class="logo-container">
                        <a href="/" class="logo"><i class="fas fa-bolt"></i>DailyPulseX</a>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="ticker">
                        <span class="ticker-label">Breaking News:</span>
                        <marquee behavior="scroll" direction="left">
                            {% for article in articles[:5] %}
                                {{ article.title }} &nbsp; | &nbsp;
                            {% endfor %}
                        </marquee>
                    </div>
                </div>
                <div class="col-md-3 text-end">
                    <button id="theme-toggle" class="btn btn-theme"><i class="fas fa-adjust"></i></button>
                </div>
            </div>
        </div>
    </header>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav mx-auto">
                    <li class="nav-item"><a class="nav-link" href="?category=all">All</a></li>
                    <li class="nav-item"><a class="nav-link" href="?category=politics">Politics</a></li>
                    <li class="nav-item"><a class="nav-link" href="?category=sports">Sports</a></li>
                    <li class="nav-item"><a class="nav-link" href="?category=business">Business</a></li>
                    <li class="nav-item"><a class="nav-link" href="?category=technology">Technology</a></li>
                    <li class="nav-item"><a class="nav-link" href="?category=entertainment">Entertainment</a></li>
                </ul>
                <form class="d-flex search-form" method="get" action="/">
                    <input type="text" class="form-control" name="text" placeholder="Search..." value="{{ text }}">
                    <button class="btn btn-search" type="submit"><i class="fas fa-search"></i></button>
                </form>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-4">
        <!-- Featured Carousel -->
        <div id="featuredCarousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
                {% for article in articles[:3] %}
                    <div class="carousel-item {% if loop.first %}active{% endif %}">
                        <div class="featured-card">
                            {% if article.image %}
                                <img src="{{ article.image }}" class="d-block w-100" alt="{{ article.title }}" loading="lazy">
                            {% else %}
                                <div class="no-image">No Image Available</div>
                            {% endif %}
                            <div class="carousel-caption">
                                <h3>{{ article.title }}</h3>
                                <button class="btn btn-describe" data-title="{{ article.title }}" data-id="desc-{{ loop.index }}"><i class="fas fa-info-circle"></i> Describe</button>
                                <div class="description" id="desc-{{ loop.index }}"></div>
                                <a href="{{ article.url }}" target="_blank" class="btn btn-read">Read More</a>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#featuredCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#featuredCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>

        <!-- Articles Grid -->
        <div class="row mt-4 articles-grid">
            {% if articles %}
                {% for article in articles[3:] %}
                    <div class="col-md-4 col-sm-6 mb-4">
                        <div class="article-card">
                            {% if article.image %}
                                <img src="{{ article.image }}" class="card-img-top" alt="{{ article.title }}" loading="lazy">
                            {% else %}
                                <div class="no-image">No Image Available</div>
                            {% endif %}
                            <div class="card-body">
                                <span class="category-tag">{{ article.category or 'General' }}</span>
                                <h5>{{ article.title }}</h5>
                                <p class="meta"><i class="fas fa-clock"></i> {{ article.publish_date }}</p>
                                <button class="btn btn-describe" data-title="{{ article.title }}" data-id="desc-{{ loop.index }}"><i class="fas fa-info-circle"></i> Describe</button>
                                <div class="description" id="desc-{{ loop.index }}"></div>
                                <a href="{{ article.url }}" target="_blank" class="btn btn-read">Read More</a>
                                <button class="btn btn-save" data-title="{{ article.title }}"><i class="fas fa-heart"></i></button>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <p class="no-articles text-center">No articles found.</p>
            {% endif %}
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <h4>About NewsPulse</h4>
                    <p>Your go-to source for breaking news and in-depth stories from around the globe.</p>
                </div>
                <div class="col-md-4">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="#privacy">Privacy Policy</a></li>
                        <li><a href="#terms">Terms of Service</a></li>
                        <li><a href="#contact">Contact Us</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h4>Follow Us</h4>
                    <a href="#" class="social-icon"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="social-icon"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
            <p class="text-center mt-3">Â© 2025 NewsPulse. Powered by Mediastack API and Gemini API.</p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script>
        // Theme Toggle
        const themeToggle = document.getElementById('theme-toggle');
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('light-theme');
            localStorage.setItem('theme', document.body.classList.contains('light-theme') ? 'light' : 'dark');
        });
        if (localStorage.getItem('theme') === 'light') {
            document.body.classList.add('light-theme');
        }

        // Describe Button
        document.addEventListener('DOMContentLoaded', () => {
            const buttons = document.querySelectorAll('.btn-describe');
            buttons.forEach(button => {
                button.addEventListener('click', async function() {
                    const title = this.getAttribute('data-title');
                    const id = this.getAttribute('data-id');
                    const descDiv = document.getElementById(id);
                    descDiv.textContent = 'Loading...';
                    this.disabled = true;
                    try {
                        const response = await fetch('/describe', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ title: title })
                        });
                        if (!response.ok) throw new Error('Network error');
                        const data = await response.json();
                        descDiv.textContent = data.desc || 'No description available';
                    } catch (error) {
                        descDiv.textContent = `Error: ${error.message}`;
                    } finally {
                        this.disabled = false;
                    }
                });
            });
        });

        // Save Button
        const saveButtons = document.querySelectorAll('.btn-save');
        saveButtons.forEach(button => {
            button.addEventListener('click', function() {
                const title = this.getAttribute('data-title');
                alert(`Saved: ${title}`);
            });
        });
    </script>
</body>
</html>